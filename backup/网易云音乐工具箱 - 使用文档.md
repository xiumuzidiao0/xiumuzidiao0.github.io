# 网易云音乐工具箱 - 使用文档

## 📖 项目简介

网易云音乐工具箱是一个功能强大的网易云音乐解析工具，支持歌曲搜索、单曲解析、歌单解析、专辑解析和音乐下载等功能。项目提供了友好的Web界面和完整的API接口，支持多种音质选择，包括无损、Hi-Res等高品质音频格式。本项目是作者使用ai改的一个开源项目，发布出来只是为了方便自己，因此不会有计划地更新维护，感兴趣的请移步原项目给[原项目](https://github.com/Suxiaoqinx/Netease_url)点点星星。
> [!NOTE]
>做了哪些改动
* 将cookie文件挂载出来
* 支持自动清理、不推送下载链接
* 支持自定义挂载下载目录
* 写入歌词到歌曲文件（支持歌词翻译）
* 修改前端

## ✨ 功能特性

### 🎵 核心功能
- **歌曲搜索**：支持关键词搜索网易云音乐库中的歌曲
- **单曲解析**：解析单首歌曲的详细信息和下载链接
- **歌单解析**：批量解析歌单中的所有歌曲
- **专辑解析**：批量解析专辑中的所有歌曲
- **音乐下载**：支持多种音质的音乐文件下载

### 🎧 音质支持
- `standard`：标准音质 (128kbps)
- `exhigh`：极高音质 (320kbps)
- `lossless`：无损音质 (FLAC)
- `hires`：Hi-Res音质 (24bit/96kHz)
- `jyeffect`：高清环绕声
- `sky`：沉浸环绕声
- `jymaster`：超清母带

### 🌐 使用方式
- **Web界面**：直观的网页操作界面
- **API接口**：完整的RESTful API
- **批量处理**：支持歌单和专辑的批量解析

## 🚀 快速开始

配置Cookie
### Cookie配置

在 `cookie.txt` 文件中配置网易云音乐Cookie：

```
MUSIC_U=你的cookie;os=pc;appver=8.9.70;
```

   在 `cookie.txt` 文件中填入黑胶会员账号的Cookie：
> [!TIP]
>  **获取Cookie方法**：
> 1. 登录网易云音乐网页版
> 2. 按F12打开开发者工具
> 3. 在Network标签页找到任意请求
> 4. 复制请求头中的Cookie值

> [!WARNING]
>**重要提示**：
> - 必须使用黑胶会员账号的Cookie
> - Cookie格式必须严格按照示例填写
> - 定期更新Cookie以保持有效性

## 🐳 Docker部署

### 使用Docker Compose

## ⚙️ 自动清理功能配置

### 功能概述

为网易云音乐下载器添加了自动清理功能，支持临时下载目录和定时自动删除文件。

### 挂载目录
- 新增 `./temp:/app/temp` 目录挂载
- 支持临时文件存储和自动清理

### 环境变量配置

#### AUTOREMOVE (默认: true)
- `true`: 歌曲下载到 `/app/temp` 目录，支持自动删除
- `false`: 歌曲下载到 `/app/downloads` 目录，永久保存，nas推荐

#### AUTO_DELETE_TIME (默认: 60)
- 设置自动删除时间间隔，单位为分钟
- 仅在 `AUTOREMOVE=true` 时生效
- 每隔指定时间自动删除 `/app/temp` 目录内的所有文件

#### WEBDL (默认: true)
- `true`: 点击下载按钮时推送下载链接到浏览器
- `false`: 不推送下载链接，仅下载到服务器本地，nas推荐

### 配置示例

#### docker-compose.yml 配置
```yaml
services:
  netease-url-for-nas:
    image: xmzd666/netease_url_for_nas:1.0
    container_name: netease-music-for-nas
    environment:
      - COOKIE_FILE=/data/cookie.txt
      - AUTOREMOVE=true # 启用自动删除功能
      - AUTO_DELETE_TIME=60 # 60分钟清理间隔
      - WEBDL=true # 启用Web下载推送
    volumes:
      - ./cookie.txt:/data/cookie.txt:ro #cookie文件
      - ./downloads:/app/downloads # 永久下载目录
      - ./temp:/app/temp # 临时下载目录
    ports:
      - "5000:5000"
    restart: unless-stopped
```
### 网易云音乐下载器环境配置

**自动删除配置**
- AUTOREMOVE=true时，文件下载到/app/temp目录
- AUTOREMOVE=false时，文件下载到/app/downloads目录
- AUTOREMOVE=true

**自动删除时间间隔（分钟）**
每隔指定时间自动删除/app/temp目录内的所有文件
- AUTO_DELETE_TIME=60

**Web下载推送配置**
- WEBDL=true时，点击下载按钮推送下载链接
- WEBDL=false时，不推送下载链接，只下载到服务器
- WEBDL=true

### 使用场景

**临时下载模式 (AUTOREMOVE=true)**
- 适用于在线试听、临时下载场景
- 自动清理避免存储空间占用
- 适合服务器部署，节省磁盘空间

**永久保存模式 (AUTOREMOVE=false)**
- 适用于音乐收藏、长期保存场景
- 文件保存在 `/app/downloads` 目录
- 不会自动删除文件

### 部署配置

#### 1. 启动服务
```bash
# 使用默认配置启动（临时模式，60分钟清理）
docker-compose up -d

# 查看日志
docker-compose logs -f
```

#### 2. 自定义配置
```bash
# 修改docker-compose.yml 中的环境变量
# 重启服务使配置生效
docker-compose restart
```

#### 3. 配置示例

**长期保存模式**
```yaml
environment:
  - AUTOREMOVE=false
```

**快速清理模式（10分钟）**
```yaml
environment:
  - AUTOREMOVE=true
  - AUTO_DELETE_TIME=10
```

**长时间保持模式（24小时）**
```yaml
environment:
  - AUTOREMOVE=true
  - AUTO_DELETE_TIME=1440 # 24 * 60 = 1440分钟
```

### 日志监控

服务会记录以下关键信息：
- 自动清理线程启动状态
- 每次自动清理的文件数量
- 当前使用的下载目录
- 配置参数（AUTOREMOVE, AUTO_DELETE_TIME）

查看日志：
```bash
docker-compose logs -f netease-url
```

2. **访问界面**

   打开浏览器访问：`http://localhost:5000

## 🎯 使用指南

### Web界面使用

#### 1. 歌曲搜索
1. 选择「歌曲搜索」功能
2. 输入搜索关键词
3. 点击「搜索」按钮
4. 在搜索结果中点击「解析」或「下载」按钮

#### 2. 单曲解析
1. 选择「单曲解析」功能
2. 输入歌曲ID或网易云音乐链接
3. 选择音质等级
4. 点击「解析」按钮查看歌曲信息
5. 点击「下载」按钮下载音乐文件

#### 3. 歌单解析
1. 选择「歌单解析」功能
2. 输入歌单ID或歌单链接
3. 点击「解析歌单」按钮
4. 查看歌单信息和歌曲列表
5. 点击单首歌曲的「解析」或「下载」按钮

#### 4. 专辑解析
1. 选择「专辑解析」功能
2. 输入专辑ID或专辑链接
3. 点击「解析专辑」按钮
4. 查看专辑信息和歌曲列表
5. 点击单首歌曲的「解析」或「下载」按钮

#### 5. 音乐下载
1. 选择「音乐下载」功能
2. 输入音乐ID或链接
3. 选择下载音质
4. 点击「下载」按钮
5. 等待下载完成

### 链接格式支持

项目支持多种网易云音乐链接格式：

- **歌曲链接**：`https://music.163.com/song?id=123456\`
- **歌单链接**：`https://music.163.com/playlist?id=123456\`
- **专辑链接**：`https://music.163.com/album?id=123456\`
- **直接ID**：`123456`

## 🔌 API接口文档

### 基础信息
- **服务地址**：`http://localhost:5000`
- **请求方式**：POST（部分接口支持GET）
- **响应格式**：JSON

### 接口列表

#### 1. 健康检查
```http
GET /health
```

**响应示例**：
```json
{
  "status": 200,
  "success": true,
  "message": "服务运行正常",
  "data": {
    "service": "网易云音乐API",
    "version": "1.0.0",
    "uptime": "2小时3分钟"
  }
}
```

#### 2. 歌曲搜索
```http
POST /search
```

**请求参数**：
```json
{
  "keyword": "搜索关键词",
  "limit": 30
}
```

**响应示例**：
```json
{
  "status": 200,
  "success": true,
  "message": "搜索完成",
  "data": [
    {
      "id": "123456",
      "name": "歌曲名称",
      "artists": "艺术家",
      "album": "专辑名称",
      "picUrl": "封面图片URL"
    }
  ]
}
```

#### 3. 单曲解析
```http
POST /song
```

**请求参数**：
```json
{
  "url": "歌曲ID或链接",
  "level": "lossless",
  "type": "json"
}
```

**响应示例**：
```json
{
  "status": 200,
  "success": true,
  "message": "解析成功",
  "data": {
    "name": "歌曲名称",
    "ar_name": "艺术家",
    "al_name": "专辑名称",
    "level": "lossless",
    "size": "45.2MB",
    "url": "下载链接",
    "pic": "封面图片",
    "lyric": "歌词内容"
  }
}
```

#### 4. 歌单解析
```http
POST /playlist
```

**请求参数**：
```json
{
  "id": "歌单ID"
}
```

**响应示例**：
```json
{
  "status": 200,
  "success": true,
  "message": "歌单解析成功",
  "data": {
    "playlist": {
      "name": "歌单名称",
      "creator": "创建者",
      "description": "歌单描述",
      "coverImgUrl": "封面图片",
      "trackCount": 50,
      "tracks": [
        {
          "id": "123456",
          "name": "歌曲名称",
          "artists": "艺术家",
          "album": "专辑名称",
          "picUrl": "封面图片"
        }
      ]
    }
  }
}
```

#### 5. 专辑解析
```http
POST /album
```

**请求参数**：
```json
{
  "id": "专辑ID"
}
```

**响应示例**：
```json
{
  "status": 200,
  "success": true,
  "message": "专辑解析成功",
  "data": {
    "album": {
      "name": "专辑名称",
      "artist": "艺术家",
      "description": "专辑描述",
      "coverImgUrl": "封面图片",
      "songs": [
        {
          "id": "123456",
          "name": "歌曲名称",
          "artists": "艺术家",
          "album": "专辑名称",
          "picUrl": "封面图片"
        }
      ]
    }
  }
}
```

#### 6. 音乐下载
```http
POST /download
```

**请求参数**：
```json
{
  "id": "音乐ID",
  "quality": "lossless"
}
```

**响应**：返回音频文件流，支持直接下载

> [!TIP]
> **故障排除**
### 常见问题
#### 1. Cookie无效
**问题**：提示Cookie无效或过期

**解决方案**：
- 确认使用的是黑胶会员账号
- 重新获取Cookie并更新 `cookie.txt`
- 检查Cookie格式是否正确

#### 2. 无法下载高音质
**问题**：只能下载标准音质

**解决方案**：
- 确认账号是黑胶会员
- 检查Cookie是否有效
- 确认歌曲本身支持高音质
- 检查网易云音乐云盘是否有该歌曲，如果有，将会直接从云盘里下载，从云盘中删除，再重新下载就可以自己选择音质